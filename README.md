# Anthem by Chorus One

Welcome to the codebase for Anthem, a multi-network platform for managing blockchain proof-of-stake networks like [Cosmos](https://cosmos.network/), [Terra](https://terra.money/), [Kava](https://www.kava.io/), [Celo](https://celo.org/), [Oasis](https://www.oasislabs.com/), and other upcoming blockchains. Anthem is open source and built and maintained by [Chorus One](https://chorus.one/).

[![CircleCI](https://circleci.com/gh/ChorusOne/anthem.svg?style=svg&circle-token=efa3725ebd2648b4c6a5289ad3bb415383f21106)](https://circleci.com/gh/ChorusOne/anthem)

<img width="1439" alt="anthem" src="https://user-images.githubusercontent.com/18126719/79953826-0ff3ca80-84af-11ea-9059-2eee118618cd.png" />

---

## Getting Started

- Clone the repo: `git clone https://github.com/ChorusOne/anthem.git`.
- Install [NodeJS](https://nodejs.org/en/) and [yarn](https://yarnpkg.com/lang/en/docs/).
- Use Node LTS: `nvm install lts/* && nvm alias default lts/*`.
- Install [Lerna](https://lerna.js.org/): `npm i -g lerna`.
- Run `lerna bootstrap` to install dependencies.
- Run `yarn utils:build` to build the utils/ package.
- Run `yarn setup` to setup environment variables.
- Run `yarn server:start` to start the server.
- Run `yarn client:start` to start the client.
- Or, run `yarn dev` to start the client in test/development mode.
- Run `yarn test` to run the project unit tests.
- Run `yarn cypress` to run the Cypress tests (requires the client app to be running).

We recommend using [VS Code](https://code.visualstudio.com/) and installing the recommended workspace extensions to make development easier.

## Project Overview

The codebase is organized into a monorepo with the following packages:

- `client/`: React client application.
- `cypress/`: Cypress e2e test suite.
- `server/`: GraphQL/Express API server.
- `utils/`: Shared utils, tools, and types.

Each package contains a README document with more specific information about that package.

## Testing

The entire project is written in TypeScript and all packages follow the same testing conventions. You can run tests at the top level or in any package with the following commands:

```sh
# runs Prettier
$ yarn prettier

# runs TSLint
$ yarn tslint

# runs the TypeScript compiler
$ yarn tsc

# runs the project unit tests using Jest in watch mode
$ yarn test:watch

# runs all the above tests
$ yarn test
```

You can also run `yarn prettier:fix` or `yarn tslint:fix` to use the auto-fix options for these tools to fix any issues (or `yarn format` to run both in one command). Normally, any linting/styling issues should be fixed automatically on-save if you are using VS Code with the recommended extensions.

The above commands cover static and unit testing the codebase. Additionally, we maintain a suite of e2e tests written with Cypress which you can run with the following commands:

```sh
# Start the client application, it needs to be running
$ yarn dev

# Run cypress
$ yarn cypress
```

This will run the Cypress tests. You can see the Cypress package README for more information.

## GraphQL

The project relies on GraphQL for the majority of the APIs. The GraphQL schema exists in the `server` package. To work with GraphQL, some tooling exists to generate TypeScript type definitions from the GraphQL schema. This generated code is in the `utils/` package and can be imported and used by other packages. to generate the type definitions, run `yarn utils:types`.

## Development Mode

Some additional tooling exists to record mock API response data to use for offline development and to run the app for the Cypress tests. The mock data is generated by running the server, querying all of the GraphQL endpoints and recording the responses. If any GraphQL APIs are updated or changed, this mock data needs to be updated. To update this data, run the following commands:

```sh
# Start the server in recording mode
$ yarn recording

# Run the script to record the data
$ yarn record
```

## Docker Images

The docker image for the Anthem backend server can be found on [Docker Hub](https://hub.docker.com/r/chorusone/anthem). The latest release is kept up to date with the master branch of this repository.

A docker image for the frontend application will be available shortly.

## Kubernetes

A Kubernetes manifest file for the backend server is included in `packages/server/anthem.yaml.dist`.

## Contributing Guidelines

We use the [Gitflow Workflow](https://www.atlassian.com/git/tutorials/comparing-workflows/gitflow-workflow) for developing new features. This involves pulling the `master` branch, developing your fix or feature on a new branch, and then creating a pull request for your code changes. It is recommended to try to keep pull requests simple and confined to a concise set of changes to make it easy to review and merge code. Pull requests require review and all status checks (continuous integration checks, for instance) to pass before merging is allowed.

Any bug fixes, improvements, or new features are welcome. Pull requests must be reviewed and pass all project tests. If you are interested in contributing, feel free to explore the [open issues](https://github.com/ChorusOne/anthem/issues) or [open an issue](https://github.com/ChorusOne/anthem/issues/new/choose) if you have an idea for an improvement or new feature.
